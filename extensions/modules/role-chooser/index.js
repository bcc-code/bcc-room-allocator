import{ref as e,computed as l,resolveComponent as o,openBlock as r,createBlock as i,withCtx as t,createCommentVNode as a,createElementVNode as n,createElementBlock as s,Fragment as u,renderList as c,unref as d,toDisplayString as v,createVNode as f,createTextVNode as m}from"vue";import{useApi as p}from"@directus/extensions-sdk";const h={class:"flex flex-wrap"},k={key:0},y=m(" Select ");var _={name:"module",setup(m){const _=e([]),C=e([]),g=e(""),x=e(null),b=l((()=>C.value?_.value.filter((e=>C.includes(e.id))):_.value)),w=p();return w.get("/users/me",{params:{fields:["role","roles.role"]}}).then((({data:{data:e}})=>{g.value=e.role,C.value=e.roles?.map((e=>e.role))})),w.get("/roles",{params:{fields:["id","name","icon","description"]}}).then((({data:{data:e}})=>_.value=e)),(e,l)=>{const m=o("v-error"),p=o("v-button"),_=o("v-info"),C=o("private-view");return r(),i(C,{title:"Choose role",id:"role-chooser"},{default:t((()=>[x.value?(r(),i(m,{key:0,error:x.value,onClick:l[0]||(l[0]=e=>x.value=null)},null,8,["error"])):a("v-if",!0),n("div",h,[(r(!0),s(u,null,c(d(b),(e=>(r(),i(_,{key:e.id,icon:e.icon,title:e.name,style:{margin:"1rem"}},{default:t((()=>[e.description?(r(),s("p",k,v(e.description),1)):a("v-if",!0),f(p,{disabled:e.id===g.value,onClick:l=>async function(e){console.log(e);try{await w.patch("/users/me",{role:e.id}),location.reload()}catch(e){x.value=e}}(e)},{default:t((()=>[y])),_:2},1032,["disabled","onClick"])])),_:2},1032,["icon","title"])))),128))])])),_:1})}},__file:"src/module.vue"},C={id:"role-chooser",name:"Role Chooser",icon:"security",routes:[{path:"",component:_}],preRegisterCheck(e,l){if(e.role.admin_access)return!0;return!!l.find((e=>"directus_users"===e.collection&&"update"===e.action&&e.fields.includes("role")))}};export{C as default};
